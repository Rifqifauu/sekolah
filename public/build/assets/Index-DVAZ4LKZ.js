import{r as l,c as n,b as e,x as C,p as B,v as T,n as m,t as o,i as p,F as L,h as V,G as f,o as r,d as j}from"./app-efhzxjot.js";import{_ as z,A as E}from"./AppLayout-DVTkLSud.js";const O={class:"p-6 max-w-6xl mx-auto"},U={class:"mb-6"},H={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Q={class:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative"},J=["value"],W=["disabled"],X={class:"flex justify-end"},Y=["disabled"],Z={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ee={class:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative"},te=["value"],se=["disabled"],ae={class:"flex justify-end"},le=["disabled"],ne={class:"space-y-6"},oe={class:"md:w-48 md:h-64 p-2 flex-shrink-0 bg-white"},re=["src"],ue={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 text-xs italic bg-gray-100 rounded"},ie={class:"p-4 flex flex-col justify-between flex-1 space-y-2 bg-white"},de={class:"text-xl font-semibold text-gray-800"},ce={class:"text-sm text-gray-500 mb-2"},ve={class:"grid grid-cols-2 gap-2 text-sm text-gray-600"},ge={class:"flex flex-wrap gap-2 pt-2 items-center"},pe={key:0,class:"grid md:grid-cols-4 gap-2 pt-4"},be=["disabled","onClick"],me=["onClick"],fe={class:"flex justify-center mt-8 flex-wrap gap-2"},xe=["onClick","innerHTML"],ye=Object.assign({layout:E},{__name:"Index",props:{data_buku:Object,query:{type:String,default:""},auth:{type:Object,default:()=>({user:null})}},setup($){const x=$,b=l(x.query);function q(){b.value.trim()&&f.get("/perpustakaan/search",{query:b.value},{preserveScroll:!0,preserveState:!0})}function D(){b.value="",f.get("/perpustakaan")}const M=l(!1),u=l(""),d=l(""),y=l(null),h=l(""),c=l(!1);function F(a){y.value=a,h.value="",u.value="",d.value="",M.value=!0}function P(){M.value=!1,y.value=null,u.value="",d.value="",c.value=!1}function K(){c.value||(c.value=!0,u.value="Memproses peminjaman...",d.value="info",f.post("/pinjam-buku",{id_buku:y.value,nomor_nfc:h.value},{onStart:()=>{u.value="Memproses peminjaman...",d.value="info"},onSuccess:()=>{u.value="✅ Berhasil meminjam buku.",d.value="success",setTimeout(()=>{P()},1500)},onError:a=>{u.value="❌ Gagal meminjam buku. Pastikan data valid.",a.nomor_nfc&&(u.value=`❌ ${a.nomor_nfc}`),d.value="error"},onFinish:()=>{c.value=!1}}))}const S=l(!1),i=l(""),v=l(""),_=l(null),k=l(""),g=l(!1);function A(a){_.value=a,k.value="",i.value="",v.value="",S.value=!0}function I(){S.value=!1,_.value=null,i.value="",v.value="",g.value=!1}function G(){g.value||(g.value=!0,i.value="Memproses pengembalian...",v.value="info",f.post("/kembalikan-buku",{id_buku:_.value,nomor_nfc:k.value},{onStart:()=>{i.value="Memproses pengembalian...",v.value="info"},onSuccess:()=>{i.value="✅ Buku berhasil dikembalikan.",v.value="success",setTimeout(()=>{I()},1500)},onError:a=>{i.value="❌ Gagal mengembalikan buku. Pastikan data valid.",a.nomor_nfc&&(i.value=`❌ ${a.nomor_nfc}`),v.value="error"},onFinish:()=>{g.value=!1}}))}function R(a){f.visit(a,{preserveScroll:!0,preserveState:!0})}return document.title="Perpustakaan",(a,s)=>(r(),n("div",O,[s[11]||(s[11]=e("h1",{class:"text-3xl font-bold mb-6 text-gray-800"},"Daftar Buku",-1)),e("div",U,[e("form",{onSubmit:C(q,["prevent"]),class:"flex items-center gap-2"},[B(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>b.value=t),type:"text",placeholder:"Cari berdasarkan judul atau pengarang...",class:"w-full border rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[T,b.value]]),s[4]||(s[4]=e("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition duration-200"},[e("i",{class:"fas fa-search"})],-1)),e("button",{type:"button",onClick:D,class:"bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 transition duration-200"},s[3]||(s[3]=[e("i",{class:"fas fa-sync-alt"},null,-1)]))],32)]),M.value?(r(),n("div",H,[e("div",Q,[s[5]||(s[5]=e("h2",{class:"text-lg font-semibold mb-4"},"Scan Kartu Anggota",-1)),u.value?(r(),n("div",{key:0,class:m(["mb-4 p-3 rounded-md text-sm",d.value==="success"?"bg-green-100 text-green-800 border border-green-300":"bg-red-100 text-red-800 border border-red-300"])},o(u.value),3)):p("",!0),e("button",{class:"absolute top-2 right-2 text-gray-500 hover:text-red-600 text-xl",onClick:P},"×"),e("form",{onSubmit:C(K,["prevent"]),class:"flex flex-col gap-2 w-full"},[e("input",{type:"hidden",name:"buku_id",value:y.value},null,8,J),B(e("input",{type:"text",name:"anggota_id","onUpdate:modelValue":s[1]||(s[1]=t=>h.value=t),placeholder:"Scan atau Masukkan Nomor NFC",required:"",class:"border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:c.value},null,8,W),[[T,h.value]]),e("div",X,[e("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition duration-200 disabled:opacity-50",disabled:c.value},o(c.value?"Memproses...":"Pinjam"),9,Y)])],32)])])):p("",!0),S.value?(r(),n("div",Z,[e("div",ee,[s[6]||(s[6]=e("h2",{class:"text-lg font-semibold mb-4"},"Masukkan ID Anggota untuk Pengembalian",-1)),i.value?(r(),n("div",{key:0,class:m(["mb-4 p-3 rounded-md text-sm",v.value==="success"?"bg-green-100 text-green-800 border border-green-300":"bg-red-100 text-red-800 border border-red-300"])},o(i.value),3)):p("",!0),e("button",{class:"absolute top-2 right-2 text-gray-500 hover:text-red-600 text-xl",onClick:I},"×"),e("form",{onSubmit:C(G,["prevent"]),class:"flex flex-col gap-2 w-full"},[e("input",{type:"hidden",name:"buku_id",value:_.value},null,8,te),B(e("input",{type:"text",name:"anggota_id","onUpdate:modelValue":s[2]||(s[2]=t=>k.value=t),placeholder:"Masukkan Nomor ID",required:"",class:"border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-green-500",disabled:g.value},null,8,se),[[T,k.value]]),e("div",ae,[e("button",{type:"submit",class:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition duration-200 disabled:opacity-50",disabled:g.value},o(g.value?"Memproses...":"Kembalikan"),9,le)])],32)])])):p("",!0),e("div",ne,[(r(!0),n(L,null,V(x.data_buku.data,t=>{var w;return r(),n("div",{key:t.id,class:"md:flex items-start border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden rounded-lg"},[e("div",oe,[t.cover?(r(),n("img",{key:0,src:`/storage/${t.cover}`,alt:"Cover Buku",class:"w-full h-full object-cover rounded"},null,8,re)):(r(),n("div",ue," No Cover "))]),e("div",ie,[e("div",null,[e("h2",de,o(t.judul_buku),1),e("p",ce,"oleh "+o(t.pengarang),1),e("div",ve,[e("p",null,[s[7]||(s[7]=e("strong",null,"Penerbit:",-1)),j(" "+o(t.penerbit??"-"),1)]),e("p",null,[s[8]||(s[8]=e("strong",null,"Tahun:",-1)),j(" "+o(t.tahun_terbit??"-"),1)]),e("p",null,[s[9]||(s[9]=e("strong",null,"ISBN:",-1)),j(" "+o(t.isbn??"-"),1)]),e("p",null,[s[10]||(s[10]=e("strong",null,"Kategori:",-1)),j(" "+o(t.kategori??"-"),1)])])]),e("div",ge,[e("span",{class:m(["inline-block px-3 py-1 text-xs font-semibold rounded-full",{"bg-green-100 text-green-800":t.status==="tersedia","bg-red-100 text-red-800":t.status==="kosong"}])},o(t.status),3),e("span",{class:m(["inline-block px-3 py-1 text-xs font-semibold rounded-full",{"bg-green-100 text-green-800":t.status==="tersedia","bg-red-100 text-red-800":t.status==="kosong"}])},o(t.jumlah-t.dipinjam),3)]),((w=x.auth.user)==null?void 0:w.role)=="pustakawan"?(r(),n("div",pe,[e("button",{class:"text-sm bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200 disabled:opacity-50",disabled:t.status==="kosong",onClick:N=>F(t.id)}," Pinjam Buku ",8,be),e("button",{class:"text-sm bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200",onClick:N=>A(t.id)}," Kembalikan Buku ",8,me)])):p("",!0)])])}),128))]),e("div",fe,[a.link&&a.link.url?(r(!0),n(L,{key:0},V(x.data_buku.links,(t,w)=>(r(),n("button",{key:w,onClick:N=>R(t.url),innerHTML:t.label,class:m(["px-3 py-2 border rounded transition duration-200",{"bg-blue-600 text-white font-bold":t.active,"hover:bg-gray-100":!t.active}])},null,10,xe))),128)):p("",!0)])]))}}),ke=z(ye,[["__scopeId","data-v-4acc604a"]]);export{ke as default};
